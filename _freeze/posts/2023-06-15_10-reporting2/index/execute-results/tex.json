{
  "hash": "98da6a252294a589359740e0b952af7e",
  "result": {
    "markdown": "---\ntitle: \"Reporting linear model parameters\"\ndate: 2023-06-15\norder: 11\nformat:\n  html: default\n  pdf: default\nprefer-html: true\n---\n\n\n\n## Loading\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidybayes)\nlibrary(gt)\nlibrary(gtsummary)\n\nlibrary(brms)\nlibrary(marginaleffects)\nlibrary(broom.mixed)\n\nsource(here::here(\"_defaults.R\"))\n```\n:::\n\n\n\nTable libraries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gtsummary)\nlibrary(stargazer)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nheight_weight_mod <- read_rds(here::here(\"posts\", \"2023-06-14_09-reporting\", \"height_weight_mod.rds\"))\n```\n:::\n\n\n\n## Off-the-shelf table methods\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheight_weight_mod |> \n  gtsummary::tbl_regression(intercept = T)\n```\n\n::: {.cell-output-display}\n|**Characteristic** | **Beta** | **95% CI** |\n|:------------------|:--------:|:----------:|\n|(Intercept)        |   155    |  154, 155  |\n|weight0            |   0.91   | 0.81, 1.0  |\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstargazer::stargazer(height_weight_mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n% Error: Unrecognized object type.\n```\n:::\n:::\n\n\n\nOh well.\n\n## Graphical summary methods\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_plot(height_weight_mod)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-6-1.png){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nheight_weight_mod |> \n  gather_draws(\n    `b_.*`,\n    sigma,\n    regex = TRUE\n  ) |> \n  ggplot(aes(.value))+\n    stat_slabinterval(\n      normalize = \"panels\",\n      point_interval = \"mean_hdi\"\n    )+\n    facet_wrap(~.variable, scales = \"free\", ncol = 1)+\n    theme_no_y()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-7-1.png){fig-pos='H'}\n:::\n:::\n\n\n\n## Custom table\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheight_weight_mod |> \n  gather_draws(\n    `b_.*`,\n    sigma,\n    regex = T \n  ) -> parameter_draws\n\nparameter_draws |> \n  group_by(.variable) |> \n  mean_hdci(.value, .width = c(0.95, 0.5)) ->\n  initial_table_long\n\ninitial_table_long\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 x 7\n  .variable    .value  .lower  .upper .width .point .interval\n  <chr>         <dbl>   <dbl>   <dbl>  <dbl> <chr>  <chr>    \n1 b_Intercept 155.    154.    155.      0.95 mean   hdci     \n2 b_weight0     0.911   0.812   1.00    0.95 mean   hdci     \n3 sigma         5.16    4.70    5.62    0.95 mean   hdci     \n4 b_Intercept 155.    154.    155.      0.5  mean   hdci     \n5 b_weight0     0.911   0.881   0.944   0.5  mean   hdci     \n6 sigma         5.16    4.98    5.29    0.5  mean   hdci     \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninitial_table_long |> \n  pivot_longer(\n    .lower:.upper,\n    names_to = \"side\",\n    values_to = \"side_value\"\n  ) |> \n  unite(\n    col = \"side\",\n    c(side, .width)\n  ) |> \n  pivot_wider(\n    names_from = side,\n    values_from = side_value\n  ) |> \n  relocate(\n    ends_with(\"_0.5\"),\n    .after = .lower_0.95\n  ) |> \n  select(-.point, -.interval) ->\n  initial_table_wide\n\ninitial_table_wide\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 x 6\n  .variable    .value .lower_0.95 .lower_0.5 .upper_0.5 .upper_0.95\n  <chr>         <dbl>       <dbl>      <dbl>      <dbl>       <dbl>\n1 b_Intercept 155.        154.       154.       155.         155.  \n2 b_weight0     0.911       0.812      0.881      0.944        1.00\n3 sigma         5.16        4.70       4.98       5.29         5.62\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nparameter_draws |> \n  group_by(.variable) |> \n  summarise(\n    posterior_sd = sd(.value)\n  ) ->\n  posterior_sd\n\nposterior_sd\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 x 2\n  .variable   posterior_sd\n  <chr>              <dbl>\n1 b_Intercept       0.324 \n2 b_weight0         0.0488\n3 sigma             0.237 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninitial_table_wide |> \n  left_join(posterior_sd) |> \n  relocate(\n    posterior_sd,\n    .after = .value\n  ) ->\n  final_report_table\n\nfinal_report_table\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 x 7\n  .variable    .value posterior_sd .lower_0.95 .lower_0.5 .upper_0.5 .upper_0.95\n  <chr>         <dbl>        <dbl>       <dbl>      <dbl>      <dbl>       <dbl>\n1 b_Intercept 155.          0.324      154.       154.       155.         155.  \n2 b_weight0     0.911       0.0488       0.812      0.881      0.944        1.00\n3 sigma         5.16        0.237        4.70       4.98       5.29         5.62\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_report_table |> \n  ungroup() |> \n  mutate(\n    group = case_when(\n      str_detect(.variable, \"b_\") ~ \"β\",\n      .default = \"variance\"\n    ),\n    .variable = str_remove(.variable, \"b_\")\n  ) |> \n  group_by(group) |> \n  gt() |> \n  fmt_number() |> \n  cols_label(\n    .variable = md(\"**parameter**\"),\n    .value = md(\"**mean**\"),\n    posterior_sd = md(\"**sd**\"),\n    .lower_0.95:.upper_0.95 ~ \"\"\n  ) |> \n  tab_spanner(\n    label = \"posterior estimates\",\n    columns = c(.value, posterior_sd)\n  ) |> \n  tab_spanner(\n    label = \"50% HDI\",\n    columns = .lower_0.5:.upper_0.5\n  ) |> \n  tab_spanner(\n    label = \"95% HDI\",\n    columns = .lower_0.95:.upper_0.95\n  ) |> \n  tab_style(\n    style = cell_fill(color = ptol_blue, alpha = 0.5),\n    locations = cells_body(\n      columns = .lower_0.5:.upper_0.5\n    )\n   ) |> \n  tab_style(\n    style = cell_fill(color = ptol_blue, alpha = 0.2),\n    locations = cells_body(\n      columns = ends_with(\"_0.95\")\n    )\n   ) |> \n  tab_style(\n    style = cell_text(style = \"italic\", size = \"small\"),\n    locations = cells_row_groups()\n  ) |> \n  tab_header(\n    title = \"height ~ weight0\"\n  ) |> \n  tab_source_note(\n    source_note = md(\"**priors:**<br>intercept &tilde; N(178, 20)<br>β &tilde; N(0,10)<br>σ &tilde; U(0,50)\")\n  )\n```\n\n::: {.cell-output-display}\n\\setlength{\\LTpost}{0mm}\n\\begin{longtable}{lrrrrrr}\n\\caption*{\n{\\large height \\textasciitilde{} weight0}\n} \\\\ \n\\toprule\n &  &  & \\multicolumn{4}{c}{95\\% HDI} \\\\ \n\\cmidrule(lr){4-7}\n & \\multicolumn{2}{c}{posterior estimates} &  & \\multicolumn{2}{c}{50\\% HDI} &  \\\\ \n\\cmidrule(lr){2-3} \\cmidrule(lr){5-6}\n\\textbf{parameter} & \\textbf{mean} & \\textbf{sd} &  &  &  &  \\\\ \n\\midrule\n\\multicolumn{7}{l}{β} \\\\ \n\\midrule\nIntercept & $154.59$ & $0.32$ & $153.92$ & $154.40$ & $154.83$ & $155.20$ \\\\ \nweight0 & $0.91$ & $0.05$ & $0.81$ & $0.88$ & $0.94$ & $1.00$ \\\\ \n\\midrule\n\\multicolumn{7}{l}{variance} \\\\ \nsigma & $5.16$ & $0.24$ & $4.70$ & $4.98$ & $5.29$ & $5.62$ \\\\ \n\\bottomrule\n\\end{longtable}\n\\begin{minipage}{\\linewidth}\n\\textbf{priors:}intercept ˜ N(178, 20)β ˜ N(0,10)σ ˜ U(0,50)\\\\\n\\end{minipage}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprior_summary(height_weight_mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           prior     class    coef group resp dpar nlpar lb ub       source\n   normal(0, 10)         b                                             user\n   normal(0, 10)         b weight0                             (vectorized)\n normal(178, 20) Intercept                                             user\n  uniform(0, 50)     sigma                                0 50         user\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "\\usepackage{booktabs}\n\\usepackage{caption}\n\\usepackage{longtable}\n"
      ]
    },
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}