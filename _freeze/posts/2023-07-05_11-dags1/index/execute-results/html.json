{
  "hash": "6c4087a6c7494a77f9d0f461f253842b",
  "result": {
    "markdown": "---\ntitle: \"DAGs part 1\"\ndate: 2023-07-05\norder: 12\ntwitter-card:\n  image: \"index_files/figure-html/fig-param2-1.png\"\nopen-graph:\n  image: \"index_files/figure-html/fig-param2-1.png\"\n---\n\n\n::: callout-note\n## Listening\n\n<iframe style=\"border-radius:12px\" src=\"https://open.spotify.com/embed/track/0EH8lce65ehgSVbMwTFMnY?utm_source=generator\" width=\"100%\" height=\"152\" frameBorder=\"0\" allowfullscreen allow=\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\" loading=\"lazy\">\n\n</iframe>\n:::\n\nSo, as a linguist, the only Directed Acyclic Graphs I've ever worked with are syntax trees. I don't know if it's embarrassing that I've never really utilized them in my statistical analysis, but I'll start to now!\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"setup\"}\nlibrary(tidyverse)\nlibrary(tidybayes)\nlibrary(gt)\nlibrary(gtsummary)\nlibrary(patchwork)\nlibrary(ggblend)\n\nlibrary(brms)\nlibrary(marginaleffects)\n\nsource(here::here(\"_defaults.R\"))\nknitr::opts_chunk$set(dev = \"png\", dev.args = list(type = \"cairo-png\"))\n```\n:::\n\n\nNew packages for today.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dagitty)\nlibrary(ggdag)\ndata(WaffleDivorce, package = \"rethinking\")\n```\n:::\n\n\n## The WaffleDivorce data\n\nI'll leave the `Location` and `Loc` columns out of the overall summary.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWaffleDivorce |> \n  select(\n    -Location, -Loc\n  ) |> \n  gtsummary::tbl_summary()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"blyggndvmi\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#blyggndvmi table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#blyggndvmi thead, #blyggndvmi tbody, #blyggndvmi tfoot, #blyggndvmi tr, #blyggndvmi td, #blyggndvmi th {\n  border-style: none;\n}\n\n#blyggndvmi p {\n  margin: 0;\n  padding: 0;\n}\n\n#blyggndvmi .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#blyggndvmi .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#blyggndvmi .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#blyggndvmi .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#blyggndvmi .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#blyggndvmi .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#blyggndvmi .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#blyggndvmi .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#blyggndvmi .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#blyggndvmi .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#blyggndvmi .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#blyggndvmi .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#blyggndvmi .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#blyggndvmi .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#blyggndvmi .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#blyggndvmi .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#blyggndvmi .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#blyggndvmi .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#blyggndvmi .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#blyggndvmi .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#blyggndvmi .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#blyggndvmi .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#blyggndvmi .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#blyggndvmi .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#blyggndvmi .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#blyggndvmi .gt_left {\n  text-align: left;\n}\n\n#blyggndvmi .gt_center {\n  text-align: center;\n}\n\n#blyggndvmi .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#blyggndvmi .gt_font_normal {\n  font-weight: normal;\n}\n\n#blyggndvmi .gt_font_bold {\n  font-weight: bold;\n}\n\n#blyggndvmi .gt_font_italic {\n  font-style: italic;\n}\n\n#blyggndvmi .gt_super {\n  font-size: 65%;\n}\n\n#blyggndvmi .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#blyggndvmi .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#blyggndvmi .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#blyggndvmi .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#blyggndvmi .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#blyggndvmi .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#blyggndvmi .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Characteristic&lt;/strong&gt;\"><strong>Characteristic</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;N = 50&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>N = 50</strong><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Population</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">4.4 (1.6, 6.7)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">MedianAgeMarriage</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">25.90 (25.33, 26.75)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Marriage</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">19.7 (17.1, 22.1)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Marriage.SE</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">1.19 (0.81, 1.77)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Divorce</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">9.75 (8.30, 10.90)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Divorce.SE</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0.80 (0.57, 1.26)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WaffleHouses</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">1 (0, 40)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">South</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">14 (28%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Slaves1860</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0 (0, 80,828)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Population1860</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">407,722 (43,321, 920,977)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PropSlaves1860</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0.00 (0.00, 0.09)</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"2\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> Median (IQR); n (%)</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n:::\n:::\n\n\nI'm not sure why everyone likes assigning the full named data frame to a new variable called `d`. It's annoying to type out `W a f f l e D i v o r c e` , but aren't we all using IDEs with tab completion?\n\nLet's look at the variables discussed in the chapter.\n\n\n::: {.cell crop='true'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"plotting code\"}\nWaffleDivorce |> \n  ggplot(aes(WaffleHouses, Divorce))+\n    geom_point() +\n    stat_smooth(\n      method = lm,\n      color = ptol_blue\n      )+\n    theme(aspect.ratio = 1)->\n  waffledivorce_p\n\nWaffleDivorce |> \n  ggplot(aes(Marriage, Divorce))+\n    geom_point() +\n    stat_smooth(\n      method = lm,\n      color = ptol_blue\n      )+\n    theme(aspect.ratio = 1) ->\n  marriagedivorce_p\n\nWaffleDivorce |> \n  ggplot(aes(MedianAgeMarriage, Divorce))+\n    geom_point() +\n    stat_smooth(\n      method = lm,\n      color = ptol_blue\n      )+\n    theme(aspect.ratio = 1) ->\n  agedivorce_p\n\nwaffledivorce_p + marriagedivorce_p + agedivorce_p\n```\n\n::: {.cell-output-display}\n![The relationship between three variables and divorce rate.](index_files/figure-html/fig-wma-divorce-1.png){#fig-wma-divorce width=768}\n:::\n:::\n\n\n## The DAG\n\nThe book mostly focuses on the effect of median age at marriage, the marriage rate, and divorce rate, which you can represent as DAG like so:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndagify(\n  divorce ~ age,\n  divorce ~ marriage,\n  marriage ~ age\n) |> \n  ggdag(\n    text_col = ptol_red\n  )+\n    theme_void()+\n    theme(\n      aspect.ratio = 1\n    )\n```\n\n::: {.cell-output-display}\n![DAG attempt 1](index_files/figure-html/fig-dag1-1.png){#fig-dag1 width=576}\n:::\n:::\n\n\nNot quite happy with this first attempt. Looks like I'll *really* have to use these single character labels, which I'm not the biggest fan of, to make them fit inside the nodes. Looks like I might also need to do more by-hand adjustment of both the coordinates of each node, and also the aesthetics of the plot.\n\n\n::: {.cell crop='true'}\n\n```{.r .cell-code}\ndagify(\n  D ~ A,\n  D ~ M,\n  M ~ A,\n  outcome = \"D\",\n  exposure = \"A\",\n  coords = \n    tribble(\n      ~name, ~x, ~y,\n      \"D\", 0, 0,\n      \"A\", -1, 0,\n      ## UGH\n      \"M\", -0.5, -sqrt(1-(0.5^2))\n    )\n) ->\n  dam_dag\n\ndam_dag |> \n  tidy_dagitty() |> \n  ggplot(aes(x =x, y = y, xend = xend, yend = yend)) +\n    geom_dag_point(\n     color = \"grey\"\n    )+\n    geom_dag_text(\n      color = ptol_blue\n    )+\n    geom_dag_edges()+\n    theme_dag()+\n    coord_fixed()\n```\n\n::: {.cell-output-display}\n![DAG attempt 2](index_files/figure-html/fig-dag2-1.png){#fig-dag2 width=384}\n:::\n:::\n\n\nWell, I'm a little annoyed at how manual getting the layout to be exactly like I wanted was, but OK.\n\n### Adding in Waffle Houses\n\nLet's figure out how to get the number of Waffle Houses into the DAG. I'll say there's a latent variable R for Region\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndagify(\n  D ~ A,\n  D ~ M,\n  M ~ A,\n  W ~ R,\n  A ~ R,\n  M ~ R,\n  outcome = \"D\",\n  exposure = c(\"M\", \"A\"),\n  latent = \"R\",\n  coords = \n    tribble(\n      ~name, ~x, ~y,\n      \"D\", 0, 0,\n      \"A\", -1, 0,\n      ## UGH\n      \"M\", -0.5, -sqrt(1-(0.5^2)),\n      \"R\", -1.5, -sqrt(1-(0.5^2)),\n      \"W\", -2, 0\n    )\n) ->\n  wrdam_dag\n\nwrdam_dag |> \n tidy_dagitty() |> \n  ggplot(aes(x =x, y = y, xend = xend, yend = yend)) +\n    geom_dag_point(\n     aes(\n       color = name == \"R\"\n     )\n    )+\n    geom_dag_text(\n      #color = ptol_blue\n    )+\n    geom_dag_edges() +\n    coord_fixed() +\n    theme_dag()+\n    theme(\n      legend.position = \"none\"\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=576}\n:::\n:::\n\n\nOk, well, we'll see how intense I ever get about making these DAG figures.\n\n## Doing the Full Luxury Bayes\n\nFirst, prepping for modelling by standardizing all of the variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWaffleDivorce |> \n  mutate(\n    divorce_z = (Divorce - mean(Divorce))/sd(Divorce),\n    age_z = (MedianAgeMarriage-mean(MedianAgeMarriage))/sd(MedianAgeMarriage),\n    marriage_z = (Marriage - mean(Marriage))/sd(Marriage)\n  )->\n  waffle_to_model\n```\n:::\n\n\nTo figure out the model we need to get the \"direct effect\" of marriage rate on divorce rate, we can use `dagitty::adjustmentSets()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndam_dag |> \n  adjustmentSets(\n    outcome = \"D\",\n    exposure = \"M\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{ A }\n```\n:::\n:::\n\n\nSo, we need to include median marriage age in the model.\n\nFor the \"full luxury Bayes\" approach, I'll combine brms formulas to model both the divorce rate and the marriage rate in one go.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaffle_formula <-   bf(\n    divorce_z ~ age_z + marriage_z\n  )+\n  bf(\n    marriage_z ~ age_z\n  )+\n  # not 100% sure this is right\n  set_rescor(F)\n```\n:::\n\n\nLet's look at the default priors. I'm, trying out some more stuff with `{gt}` here to get a table I like, but it takes up a lot of space so I'm collapsing it. I also need to figure out what kind of behavior makes sense to me for table captions created by quarto and table titles created by `{gt}`.\n\n\n::: {#tbl-prior1 .cell tbl-cap='Default priors'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"table code\"}\nget_prior(\n  waffle_formula,\n  data = waffle_to_model\n) |> \n  as_tibble() |> \n  select(\n    prior,\n    class,\n    coef,\n    resp\n  ) |> \n  group_by(class) |> \n  filter(\n    str_length(resp) > 0\n  ) |> \n  filter(\n    !(class == \"b\" & coef == \"\")\n  ) |> \n  gt(\n    rowname_col = \"prior\"\n  ) |> \n    sub_values(\n      columns = prior,\n      values = \"\",\n      replacement = \"flat\"\n    ) |> \n    tab_stub_indent(\n      rows = everything(),\n      indent = 2\n    ) |> \n  tab_header(\n    title = md(\"Default `brms` priors\")\n  )\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"eplrcjrcei\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#eplrcjrcei table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#eplrcjrcei thead, #eplrcjrcei tbody, #eplrcjrcei tfoot, #eplrcjrcei tr, #eplrcjrcei td, #eplrcjrcei th {\n  border-style: none;\n}\n\n#eplrcjrcei p {\n  margin: 0;\n  padding: 0;\n}\n\n#eplrcjrcei .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#eplrcjrcei .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#eplrcjrcei .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#eplrcjrcei .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#eplrcjrcei .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#eplrcjrcei .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#eplrcjrcei .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#eplrcjrcei .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#eplrcjrcei .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#eplrcjrcei .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#eplrcjrcei .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#eplrcjrcei .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#eplrcjrcei .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#eplrcjrcei .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#eplrcjrcei .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eplrcjrcei .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#eplrcjrcei .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#eplrcjrcei .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#eplrcjrcei .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eplrcjrcei .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#eplrcjrcei .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eplrcjrcei .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#eplrcjrcei .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eplrcjrcei .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#eplrcjrcei .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eplrcjrcei .gt_left {\n  text-align: left;\n}\n\n#eplrcjrcei .gt_center {\n  text-align: center;\n}\n\n#eplrcjrcei .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#eplrcjrcei .gt_font_normal {\n  font-weight: normal;\n}\n\n#eplrcjrcei .gt_font_bold {\n  font-weight: bold;\n}\n\n#eplrcjrcei .gt_font_italic {\n  font-style: italic;\n}\n\n#eplrcjrcei .gt_super {\n  font-size: 65%;\n}\n\n#eplrcjrcei .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#eplrcjrcei .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#eplrcjrcei .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#eplrcjrcei .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#eplrcjrcei .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#eplrcjrcei .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#eplrcjrcei .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"3\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Default <code>brms</code> priors</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"coef\">coef</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"resp\">resp</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"3\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"b\">b</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"b stub_1_1 stub_1\" class=\"gt_row gt_left gt_stub gt_indent_2\">flat</td>\n<td headers=\"b stub_1_1 coef\" class=\"gt_row gt_left\">age_z</td>\n<td headers=\"b stub_1_1 resp\" class=\"gt_row gt_left\">divorcez</td></tr>\n    <tr><td headers=\"b stub_1_2 stub_1\" class=\"gt_row gt_left gt_stub gt_indent_2\">flat</td>\n<td headers=\"b stub_1_2 coef\" class=\"gt_row gt_left\">marriage_z</td>\n<td headers=\"b stub_1_2 resp\" class=\"gt_row gt_left\">divorcez</td></tr>\n    <tr><td headers=\"b stub_1_3 stub_1\" class=\"gt_row gt_left gt_stub gt_indent_2\">flat</td>\n<td headers=\"b stub_1_3 coef\" class=\"gt_row gt_left\">age_z</td>\n<td headers=\"b stub_1_3 resp\" class=\"gt_row gt_left\">marriagez</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"3\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Intercept\">Intercept</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Intercept stub_1_4 stub_1\" class=\"gt_row gt_left gt_stub gt_indent_2\">student_t(3, 0, 2.5)</td>\n<td headers=\"Intercept stub_1_4 coef\" class=\"gt_row gt_left\"></td>\n<td headers=\"Intercept stub_1_4 resp\" class=\"gt_row gt_left\">divorcez</td></tr>\n    <tr><td headers=\"Intercept stub_1_5 stub_1\" class=\"gt_row gt_left gt_stub gt_indent_2\">student_t(3, -0.1, 2.5)</td>\n<td headers=\"Intercept stub_1_5 coef\" class=\"gt_row gt_left\"></td>\n<td headers=\"Intercept stub_1_5 resp\" class=\"gt_row gt_left\">marriagez</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"3\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"sigma\">sigma</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"sigma stub_1_6 stub_1\" class=\"gt_row gt_left gt_stub gt_indent_2\">student_t(3, 0, 2.5)</td>\n<td headers=\"sigma stub_1_6 coef\" class=\"gt_row gt_left\"></td>\n<td headers=\"sigma stub_1_6 resp\" class=\"gt_row gt_left\">divorcez</td></tr>\n    <tr><td headers=\"sigma stub_1_7 stub_1\" class=\"gt_row gt_left gt_stub gt_indent_2\">student_t(3, 0, 2.5)</td>\n<td headers=\"sigma stub_1_7 coef\" class=\"gt_row gt_left\"></td>\n<td headers=\"sigma stub_1_7 resp\" class=\"gt_row gt_left\">marriagez</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nSo, a thing that hadn't really clicked with me until I was teaching from Bodo Winter's textbook is that if you z-score both the outcome and the predictors in a model, the resulting slopes are Pearson's r, which is always going to be $-1 \\le \\rho \\le 1$. Not that we really have to stress it with this particular data and model, efficiencywise, but we can set a prior on these slopes with a relatively narrow scale, and it'll be pretty reasonable. Here's a normal(0, 0.5) and a student_t(3, 0, 0.5) for comparison.\n\n\n::: {.cell crop='true'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"plotting code\"}\ntibble(\n  x = seq(-1.5, 1.5, length = 500),\n  dens = dnorm(x, sd = 0.5),\n  prior = \"normal(0, 0.5)\"\n) |> \n  bind_rows(\n    tibble(\n      x = seq(-1.5, 1.5, length = 500),\n      dens = dstudent_t(x, df = 3, sigma = 0.5),\n      prior = \"student_t(3, 0, 0.5)\"\n    )\n  ) |> \n  ggplot(\n    aes(x = x, y = dens)\n  )+\n  list(\n    geom_area(\n      aes(fill = prior),\n      position = \"identity\",\n      #alpha = 0.6,\n      color = \"black\"\n    ) |>  blend(\"multiply\"),\n    geom_vline(\n      xintercept = c(-1, 1),\n      linewidth = 1,\n      color = \"grey40\"\n    )) |> \n    blend(\"screen\")+ \n    khroma::scale_fill_bright(\n      limits = c( \n        \"student_t(3, 0, 0.5)\",\n         \"normal(0, 0.5)\"\n      )\n    )+\n    labs(\n      x = NULL\n    ) +\n    scale_y_continuous(\n      expand = expansion(mult = 0.01)\n    ) +\n    theme_no_y()\n```\n\n::: {.cell-output-display}\n![Comparison of a normal and t distribution](index_files/figure-html/fig-prior-comparison-1.png){#fig-prior-comparison width=768}\n:::\n:::\n\n\nI'll use the slightly broader t distribution for the slope priors.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslope_priors <- prior(\n  student_t(3, 0, 0.5),\n  class = b\n)\n```\n:::\n\n\nNow for fitting the whole thing.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbrm(\n  formula = waffle_formula,\n  prior = slope_priors,\n  data = waffle_to_model,\n  backend = \"cmdstanr\",\n  file = \"dam.rds\",\n  cores = 4\n)->\n  full_model\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_model\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Family: MV(gaussian, gaussian) \n  Links: mu = identity; sigma = identity\n         mu = identity; sigma = identity \nFormula: divorce_z ~ age_z + marriage_z \n         marriage_z ~ age_z \n   Data: waffle_to_model (Number of observations: 50) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nPopulation-Level Effects: \n                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\ndivorcez_Intercept      0.00      0.12    -0.23     0.24 1.00     6550     3104\nmarriagez_Intercept    -0.00      0.10    -0.20     0.20 1.00     6593     2946\ndivorcez_age_z         -0.61      0.17    -0.94    -0.28 1.00     3753     3193\ndivorcez_marriage_z    -0.06      0.16    -0.38     0.24 1.00     3876     3235\nmarriagez_age_z        -0.70      0.10    -0.90    -0.48 1.00     5942     2618\n\nFamily Specific Parameters: \n                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma_divorcez      0.84      0.09     0.69     1.03 1.00     5746     2990\nsigma_marriagez     0.72      0.08     0.59     0.89 1.00     6880     2852\n\nDraws were sampled using sample(hmc). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n:::\n:::\n\n\n## Marginalizing\n\nSo, to \"marginalize\" over age, to get the direct effect of the marriage rate, I'd like to use the `marginaleffects::slopes()` function, but I think we've got a slight issue.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslopes(\n  full_model\n) |> \n  as_tibble() |> \n  filter(group == \"divorcez\") |> \n  count(term)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 2\n  term      n\n  <chr> <int>\n1 age_z    50\n```\n:::\n:::\n\n\nBecause `marriage_z` is also an *outcome* variable, it doesn't want to give me its marginal slopes in the `divorce_z` outcome model. So much for full luxury bayes! But I can work around with `predictions`. I think what I want to use is `grid_typ=\"counterfactual\"` in `datagrid()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatagrid(\n  model = full_model,\n  marriage_z = c(0,1),\n  grid_type = \"counterfactual\"\n) |> \n  rmarkdown::paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"rowidcf\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"divorce_z\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"age_z\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"marriage_z\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1.65420530\",\"3\":\"-0.60628951\",\"4\":\"0\"},{\"1\":\"2\",\"2\":\"1.54436431\",\"3\":\"-0.68669925\",\"4\":\"0\"},{\"1\":\"3\",\"2\":\"0.61071590\",\"3\":\"-0.20424076\",\"4\":\"0\"},{\"1\":\"4\",\"2\":\"2.09356925\",\"3\":\"-1.41038699\",\"4\":\"0\"},{\"1\":\"5\",\"2\":\"-0.92705795\",\"3\":\"0.59985673\",\"4\":\"0\"},{\"1\":\"6\",\"2\":\"1.05007986\",\"3\":\"-0.28465051\",\"4\":\"0\"},{\"1\":\"7\",\"2\":\"-1.64102438\",\"3\":\"1.24313471\",\"4\":\"0\"},{\"1\":\"8\",\"2\":\"-0.43277350\",\"3\":\"0.43903723\",\"4\":\"0\"},{\"1\":\"9\",\"2\":\"-1.86070636\",\"3\":\"2.93173944\",\"4\":\"0\"},{\"1\":\"10\",\"2\":\"-0.65245548\",\"3\":\"0.27821773\",\"4\":\"0\"},{\"1\":\"11\",\"2\":\"0.99515936\",\"3\":\"-0.12383101\",\"4\":\"0\"},{\"1\":\"12\",\"2\":\"-0.76229646\",\"3\":\"0.68026647\",\"4\":\"0\"},{\"1\":\"13\",\"2\":\"-1.09181943\",\"3\":\"-2.29489423\",\"4\":\"0\"},{\"1\":\"14\",\"2\":\"-0.92705795\",\"3\":\"0.76067622\",\"4\":\"0\"},{\"1\":\"15\",\"2\":\"0.72055689\",\"3\":\"-0.28465051\",\"4\":\"0\"},{\"1\":\"16\",\"2\":\"0.28119293\",\"3\":\"-0.52587976\",\"4\":\"0\"},{\"1\":\"17\",\"2\":\"0.50087491\",\"3\":\"-0.84751875\",\"4\":\"0\"},{\"1\":\"18\",\"2\":\"1.59928480\",\"3\":\"-1.00833825\",\"4\":\"0\"},{\"1\":\"19\",\"2\":\"0.72055689\",\"3\":\"-0.12383101\",\"4\":\"0\"},{\"1\":\"20\",\"2\":\"1.81896678\",\"3\":\"0.27821773\",\"4\":\"0\"},{\"1\":\"21\",\"2\":\"-0.48769399\",\"3\":\"1.00190547\",\"4\":\"0\"},{\"1\":\"22\",\"2\":\"-1.03689894\",\"3\":\"1.96682245\",\"4\":\"0\"},{\"1\":\"23\",\"2\":\"-0.26801201\",\"3\":\"0.27821773\",\"4\":\"0\"},{\"1\":\"24\",\"2\":\"-1.25658092\",\"3\":\"0.19780798\",\"4\":\"0\"},{\"1\":\"25\",\"2\":\"0.77547738\",\"3\":\"-0.20424076\",\"4\":\"0\"},{\"1\":\"26\",\"2\":\"-0.10325053\",\"3\":\"-0.36506026\",\"4\":\"0\"},{\"1\":\"27\",\"2\":\"-0.32293251\",\"3\":\"-0.28465051\",\"4\":\"0\"},{\"1\":\"28\",\"2\":\"-0.48769399\",\"3\":\"-0.52587976\",\"4\":\"0\"},{\"1\":\"29\",\"2\":\"0.22627244\",\"3\":\"0.59985673\",\"4\":\"0\"},{\"1\":\"30\",\"2\":\"-1.97054734\",\"3\":\"1.32354446\",\"4\":\"0\"},{\"1\":\"31\",\"2\":\"0.28119293\",\"3\":\"-0.20424076\",\"4\":\"0\"},{\"1\":\"32\",\"2\":\"-1.69594487\",\"3\":\"1.88641270\",\"4\":\"0\"},{\"1\":\"33\",\"2\":\"0.11643145\",\"3\":\"-0.28465051\",\"4\":\"0\"},{\"1\":\"34\",\"2\":\"-0.92705795\",\"3\":\"-0.60628951\",\"4\":\"0\"},{\"1\":\"35\",\"2\":\"-0.10325053\",\"3\":\"0.19780798\",\"4\":\"0\"},{\"1\":\"36\",\"2\":\"1.70912579\",\"3\":\"-1.32997724\",\"4\":\"0\"},{\"1\":\"37\",\"2\":\"0.39103392\",\"3\":\"-0.04342126\",\"4\":\"0\"},{\"1\":\"38\",\"2\":\"-1.09181943\",\"3\":\"0.84108597\",\"4\":\"0\"},{\"1\":\"39\",\"2\":\"-0.15817102\",\"3\":\"1.72559321\",\"4\":\"0\"},{\"1\":\"40\",\"2\":\"-0.87213745\",\"3\":\"0.27821773\",\"4\":\"0\"},{\"1\":\"41\",\"2\":\"0.66563639\",\"3\":\"-0.36506026\",\"4\":\"0\"},{\"1\":\"42\",\"2\":\"0.94023887\",\"3\":\"-0.68669925\",\"4\":\"0\"},{\"1\":\"43\",\"2\":\"0.17135194\",\"3\":\"-0.68669925\",\"4\":\"0\"},{\"1\":\"44\",\"2\":\"0.28119293\",\"3\":\"-2.21448448\",\"4\":\"0\"},{\"1\":\"45\",\"2\":\"-0.04833004\",\"3\":\"0.68026647\",\"4\":\"0\"},{\"1\":\"46\",\"2\":\"-0.43277350\",\"3\":\"0.27821773\",\"4\":\"0\"},{\"1\":\"47\",\"2\":\"0.17135194\",\"3\":\"-0.12383101\",\"4\":\"0\"},{\"1\":\"48\",\"2\":\"0.66563639\",\"3\":\"-0.84751875\",\"4\":\"0\"},{\"1\":\"49\",\"2\":\"-0.76229646\",\"3\":\"0.19780798\",\"4\":\"0\"},{\"1\":\"50\",\"2\":\"0.33611343\",\"3\":\"-1.49079674\",\"4\":\"0\"},{\"1\":\"1\",\"2\":\"1.65420530\",\"3\":\"-0.60628951\",\"4\":\"1\"},{\"1\":\"2\",\"2\":\"1.54436431\",\"3\":\"-0.68669925\",\"4\":\"1\"},{\"1\":\"3\",\"2\":\"0.61071590\",\"3\":\"-0.20424076\",\"4\":\"1\"},{\"1\":\"4\",\"2\":\"2.09356925\",\"3\":\"-1.41038699\",\"4\":\"1\"},{\"1\":\"5\",\"2\":\"-0.92705795\",\"3\":\"0.59985673\",\"4\":\"1\"},{\"1\":\"6\",\"2\":\"1.05007986\",\"3\":\"-0.28465051\",\"4\":\"1\"},{\"1\":\"7\",\"2\":\"-1.64102438\",\"3\":\"1.24313471\",\"4\":\"1\"},{\"1\":\"8\",\"2\":\"-0.43277350\",\"3\":\"0.43903723\",\"4\":\"1\"},{\"1\":\"9\",\"2\":\"-1.86070636\",\"3\":\"2.93173944\",\"4\":\"1\"},{\"1\":\"10\",\"2\":\"-0.65245548\",\"3\":\"0.27821773\",\"4\":\"1\"},{\"1\":\"11\",\"2\":\"0.99515936\",\"3\":\"-0.12383101\",\"4\":\"1\"},{\"1\":\"12\",\"2\":\"-0.76229646\",\"3\":\"0.68026647\",\"4\":\"1\"},{\"1\":\"13\",\"2\":\"-1.09181943\",\"3\":\"-2.29489423\",\"4\":\"1\"},{\"1\":\"14\",\"2\":\"-0.92705795\",\"3\":\"0.76067622\",\"4\":\"1\"},{\"1\":\"15\",\"2\":\"0.72055689\",\"3\":\"-0.28465051\",\"4\":\"1\"},{\"1\":\"16\",\"2\":\"0.28119293\",\"3\":\"-0.52587976\",\"4\":\"1\"},{\"1\":\"17\",\"2\":\"0.50087491\",\"3\":\"-0.84751875\",\"4\":\"1\"},{\"1\":\"18\",\"2\":\"1.59928480\",\"3\":\"-1.00833825\",\"4\":\"1\"},{\"1\":\"19\",\"2\":\"0.72055689\",\"3\":\"-0.12383101\",\"4\":\"1\"},{\"1\":\"20\",\"2\":\"1.81896678\",\"3\":\"0.27821773\",\"4\":\"1\"},{\"1\":\"21\",\"2\":\"-0.48769399\",\"3\":\"1.00190547\",\"4\":\"1\"},{\"1\":\"22\",\"2\":\"-1.03689894\",\"3\":\"1.96682245\",\"4\":\"1\"},{\"1\":\"23\",\"2\":\"-0.26801201\",\"3\":\"0.27821773\",\"4\":\"1\"},{\"1\":\"24\",\"2\":\"-1.25658092\",\"3\":\"0.19780798\",\"4\":\"1\"},{\"1\":\"25\",\"2\":\"0.77547738\",\"3\":\"-0.20424076\",\"4\":\"1\"},{\"1\":\"26\",\"2\":\"-0.10325053\",\"3\":\"-0.36506026\",\"4\":\"1\"},{\"1\":\"27\",\"2\":\"-0.32293251\",\"3\":\"-0.28465051\",\"4\":\"1\"},{\"1\":\"28\",\"2\":\"-0.48769399\",\"3\":\"-0.52587976\",\"4\":\"1\"},{\"1\":\"29\",\"2\":\"0.22627244\",\"3\":\"0.59985673\",\"4\":\"1\"},{\"1\":\"30\",\"2\":\"-1.97054734\",\"3\":\"1.32354446\",\"4\":\"1\"},{\"1\":\"31\",\"2\":\"0.28119293\",\"3\":\"-0.20424076\",\"4\":\"1\"},{\"1\":\"32\",\"2\":\"-1.69594487\",\"3\":\"1.88641270\",\"4\":\"1\"},{\"1\":\"33\",\"2\":\"0.11643145\",\"3\":\"-0.28465051\",\"4\":\"1\"},{\"1\":\"34\",\"2\":\"-0.92705795\",\"3\":\"-0.60628951\",\"4\":\"1\"},{\"1\":\"35\",\"2\":\"-0.10325053\",\"3\":\"0.19780798\",\"4\":\"1\"},{\"1\":\"36\",\"2\":\"1.70912579\",\"3\":\"-1.32997724\",\"4\":\"1\"},{\"1\":\"37\",\"2\":\"0.39103392\",\"3\":\"-0.04342126\",\"4\":\"1\"},{\"1\":\"38\",\"2\":\"-1.09181943\",\"3\":\"0.84108597\",\"4\":\"1\"},{\"1\":\"39\",\"2\":\"-0.15817102\",\"3\":\"1.72559321\",\"4\":\"1\"},{\"1\":\"40\",\"2\":\"-0.87213745\",\"3\":\"0.27821773\",\"4\":\"1\"},{\"1\":\"41\",\"2\":\"0.66563639\",\"3\":\"-0.36506026\",\"4\":\"1\"},{\"1\":\"42\",\"2\":\"0.94023887\",\"3\":\"-0.68669925\",\"4\":\"1\"},{\"1\":\"43\",\"2\":\"0.17135194\",\"3\":\"-0.68669925\",\"4\":\"1\"},{\"1\":\"44\",\"2\":\"0.28119293\",\"3\":\"-2.21448448\",\"4\":\"1\"},{\"1\":\"45\",\"2\":\"-0.04833004\",\"3\":\"0.68026647\",\"4\":\"1\"},{\"1\":\"46\",\"2\":\"-0.43277350\",\"3\":\"0.27821773\",\"4\":\"1\"},{\"1\":\"47\",\"2\":\"0.17135194\",\"3\":\"-0.12383101\",\"4\":\"1\"},{\"1\":\"48\",\"2\":\"0.66563639\",\"3\":\"-0.84751875\",\"4\":\"1\"},{\"1\":\"49\",\"2\":\"-0.76229646\",\"3\":\"0.19780798\",\"4\":\"1\"},{\"1\":\"50\",\"2\":\"0.33611343\",\"3\":\"-1.49079674\",\"4\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npredictions(\n  full_model,\n  newdata = datagrid(\n    marriage_z = c(0,1),\n    grid_type = \"counterfactual\"\n  )\n) |> \n  posterior_draws() |> \n  filter(group == \"divorcez\") ->\n  divorce_pred\n\nnrow(divorce_pred)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 400000\n```\n:::\n:::\n\n\nOk, this gives us 40,000 values, which is 20,000 for `marriage_z == 0` and 20,000 for `marriage_z == 1`. And given that the original data had 50 rows, that's back to the 4,000 posterior samples we got from the model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(divorce_pred) |> \n  rmarkdown::paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"drawid\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"draw\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"rowid\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"rowidcf\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"group\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"divorce_z\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"age_z\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"marriage_z\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"0.31716639\",\"3\":\"1\",\"4\":\"1\",\"5\":\"divorcez\",\"6\":\"0.3755182\",\"7\":\"0.07073877\",\"8\":\"0.67859668\",\"9\":\"1.6542053\",\"10\":\"-0.6062895\",\"11\":\"0\",\"_rn_\":\"1\"},{\"1\":\"1\",\"2\":\"0.37623434\",\"3\":\"2\",\"4\":\"2\",\"5\":\"divorcez\",\"6\":\"0.4245601\",\"7\":\"0.10282018\",\"8\":\"0.74812006\",\"9\":\"1.5443643\",\"10\":\"-0.6866993\",\"11\":\"0\",\"_rn_\":\"2\"},{\"1\":\"1\",\"2\":\"0.02182661\",\"3\":\"3\",\"4\":\"3\",\"5\":\"divorcez\",\"6\":\"0.1272642\",\"7\":\"-0.11124994\",\"8\":\"0.37830000\",\"9\":\"0.6107159\",\"10\":\"-0.2042408\",\"11\":\"0\",\"_rn_\":\"3\"},{\"1\":\"1\",\"2\":\"0.90784595\",\"3\":\"4\",\"4\":\"4\",\"5\":\"divorcez\",\"6\":\"0.8730653\",\"7\":\"0.35141203\",\"8\":\"1.38534333\",\"9\":\"2.0935693\",\"10\":\"-1.4103870\",\"11\":\"0\",\"_rn_\":\"4\"},{\"1\":\"1\",\"2\":\"-0.56885295\",\"3\":\"5\",\"4\":\"5\",\"5\":\"divorcez\",\"6\":\"-0.3666381\",\"7\":\"-0.67327167\",\"8\":\"-0.05273362\",\"9\":\"-0.9270579\",\"10\":\"0.5998567\",\"11\":\"0\",\"_rn_\":\"5\"},{\"1\":\"1\",\"2\":\"0.08089456\",\"3\":\"6\",\"4\":\"6\",\"5\":\"divorcez\",\"6\":\"0.1774224\",\"7\":\"-0.07374717\",\"8\":\"0.43870344\",\"9\":\"1.0500799\",\"10\":\"-0.2846505\",\"11\":\"0\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThe `draw` column has the posterior draw, so what I want to do is pivot wider so there's a column for `marriage_z==0` and `marriage_z==1`, then subtract one from the other. I had some issues figuring out which columns need to get dropped for that to happen cleanly, but the answer is `rowid` and, I think, everything from `estimate` through `conf.high`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndivorce_pred |> \n  select(\n    -rowid,\n    -(estimate:conf.high)\n    ) |> \n  pivot_wider(\n    names_from = marriage_z,\n    values_from = draw\n  ) |> \n  mutate(marriage_effect = `1`-`0`) |> \n  group_by(drawid) |> \n  summarise(\n    avg_marriage_effect = mean(marriage_effect)\n  ) ->\n  avg_marriage_effect\n```\n:::\n\n\nAs it turns out, every estimate of `marriage_effect` was the same within each draw, but this might not've been the case for a model with interactions, say.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"plotting code\"}\navg_marriage_effect |> \n  ggplot(aes(avg_marriage_effect)) +\n  list(\n    stat_halfeye(\n      point_interval = \"mean_hdci\",\n      fill = ptol_blue,\n      slab_color = \"black\"\n    ),\n    geom_vline(\n      xintercept = 0,\n      color = \"grey40\",\n      linewidth = 1\n    )) |> blend(\"screen\")+\n    scale_y_continuous(\n      expand = expansion(mult = 0.02)\n    )+\n    labs(x = \"marriage direct effect\")+\n    theme_no_y()\n```\n\n::: {.cell-output-display}\n![Marriage rate direct effect on divorce rate](index_files/figure-html/fig-avg-marriage-effect-1.png){#fig-avg-marriage-effect width=576}\n:::\n:::\n\n\nI have a sneaking suspicion that for this case, this is identical to the estimate of the slope.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"plotting code\"}\nfull_model |> \n  spread_draws(\n    b_divorcez_marriage_z\n  ) |> \n  ggplot(aes(b_divorcez_marriage_z)) +\n  list(\n    stat_halfeye(\n      point_interval = \"mean_hdci\",\n      fill = ptol_blue,\n      slab_color = \"black\"\n    ),\n    geom_vline(\n      xintercept = 0,\n      color = \"grey40\",\n      linewidth = 1\n    )) |> blend(\"screen\")+\n    scale_y_continuous(\n      expand = expansion(mult = 0.02)\n    )+\n    theme_no_y()\n```\n\n::: {.cell-output-display}\n![Posterior slope of marriage rate on divorce rate](index_files/figure-html/fig-marriage-slope-1.png){#fig-marriage-slope width=576}\n:::\n:::\n\n\nLol, well.\n\n## One big plot\n\nLet's make one big plot of all the estimated effects. Not all of the parameters from the model are ones we'll want\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_model |> \n  get_variables()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"b_divorcez_Intercept\"  \"b_marriagez_Intercept\" \"b_divorcez_age_z\"     \n [4] \"b_divorcez_marriage_z\" \"b_marriagez_age_z\"     \"sigma_divorcez\"       \n [7] \"sigma_marriagez\"       \"lprior\"                \"lp__\"                 \n[10] \"accept_stat__\"         \"treedepth__\"           \"stepsize__\"           \n[13] \"divergent__\"           \"n_leapfrog__\"          \"energy__\"             \n```\n:::\n:::\n\n\nI'll grab all the betas and the sigmas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_model |> \n  gather_draws(\n    `b_.*`,\n    `sigma_.*`,\n    regex = T\n  )->\n  all_param_draws\n```\n:::\n\n\nI'll want to facet the plots by whether we're looking at draws for the marriage rate outcome or for the divorce rate outcome, so I'll create some new columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_param_draws |> \n  mutate(\n    outcome = case_when(\n      str_detect(.variable, \"marriagez\")~\"marriage rate~\",\n      str_detect(.variable, \"divorcez\")~\"divorce rate~\"\n    ),\n    class = case_when(\n      str_detect(.variable, \"b_\") ~ \"betas\",\n      str_detect(.variable, \"sigma\") ~ \"sigmas\"\n    )\n  ) -> \n  all_param_draws\n```\n:::\n\n\nAnd now I'll want a new cleaned up variable name for plotting.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_param_draws |> \n  mutate(\n    param = .variable |> \n      str_remove(\"b\") |> \n      str_remove(\"_divorcez\") |> \n      str_remove(\"_marriagez\") |> \n      str_remove(\"^_\")\n  )->\n  all_param_draws\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"plotting code\"}\nall_param_draws |> \n  mutate(\n    param = factor(\n      param,\n      levels = rev(c(\n        \"Intercept\", \n        \"age_z\", \n        \"marriage_z\", \n        \"sigma\"\n        ))\n    )\n  ) |> \n  ggplot(aes(.value, param))+\n    stat_halfeye(\n      aes(\n        fill = after_stat(x < 0)\n      ),\n      point_interval = \"mean_hdci\"\n    )+\n    scale_x_continuous(\n      breaks = c(-1, 0, 1)\n    )+\n    labs(y = NULL,\n         x = NULL)+\n    facet_grid(\n      class ~ outcome, \n      space = \"free\",\n      scales = \"free\"\n    )+\n    theme(\n      legend.position = \"none\"\n    )\n```\n\n::: {.cell-output-display}\n![Posterior estimates of model parameters](index_files/figure-html/fig-param-plot-1.png){#fig-param-plot width=576}\n:::\n:::\n\n\nOne thing that's maybe less than ideal is that the sigma parameters really aren't on the same kind of scale here. Maybe they should be in a completely different plot, and put together with patchwork?\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"plotting code\"}\nall_param_draws |> \n  mutate(\n    param = factor(\n      param,\n      levels = rev(c(\n        \"Intercept\", \n        \"age_z\", \n        \"marriage_z\", \n        \"sigma\"\n        ))\n    )\n  ) ->\n  param_to_plot\n\nparam_to_plot |> \n  filter(class == \"betas\") |> \n  ggplot(aes(.value, param))+\n  list(\n    stat_halfeye(\n      aes(\n        fill = after_stat(x < 0)\n      ),\n      point_interval = \"mean_hdci\"\n    ),\n    geom_vline(\n      xintercept = 0,\n      color = \"grey40\",\n      linewidth = 1\n    )\n  ) |> \n  blend(\"screen\")+\n    #scale_x_continuous(\n    #  breaks = c(-1, 0, 1)\n    #)+\n    labs(y = NULL,\n         x = NULL)+\n    facet_grid(\n      class ~ outcome\n      #space = \"free\",\n      #scales = \"free\"\n    )+\n    theme(\n      legend.position = \"none\"\n    )->\n  betas\n\nparam_to_plot |> \n  filter(class == \"sigmas\") |> \n  ggplot(aes(.value, param))+\n    stat_halfeye(\n      aes(\n        fill = after_stat(x < 0)\n      ),\n      point_interval = \"mean_hdci\"\n    )+\n    geom_vline(\n      xintercept = 0,\n      color = \"black\",\n      linewidth = 1\n    )+\n    #scale_x_continuous(\n    #  breaks = c(-1, 0, 1)\n    #)+\n    labs(y = NULL,\n         x = NULL)+\n    facet_grid(\n      class ~ outcome, \n      #space = \"free\",\n      #scales = \"free\"\n    )+\n    expand_limits(x = 0)+\n    theme(\n      legend.position = \"none\",\n      strip.text.x = element_blank()\n    ) -> \n  sigmas\n\n\nlayout <- \"\nA\nA\nA\nB\n\"\n\nbetas + sigmas + plot_layout(design = layout)\n```\n\n::: {.cell-output-display}\n![Posterior estimates of model parameters](index_files/figure-html/fig-param2-1.png){#fig-param2 width=576}\n:::\n:::\n\n\nHm, idk.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}