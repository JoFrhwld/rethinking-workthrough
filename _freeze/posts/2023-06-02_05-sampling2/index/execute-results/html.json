{
  "hash": "c641681294285a8337b3ac4ae81c2984",
  "result": {
    "markdown": "---\ntitle: \"Sampling Summaries\"\n---\n\n\n::: callout-note\n## Listening\n\n<iframe style=\"border-radius:12px\" src=\"https://open.spotify.com/embed/track/2wVkNt9Z1IYHirENKvmkto?utm_source=generator\" width=\"100%\" height=\"152\" frameBorder=\"0\" allowfullscreen allow=\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\" loading=\"lazy\">\n\n</iframe>\n:::\n\n## Loading\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(tidybayes)\nlibrary(ggdist)\nlibrary(here)\n\nsource(here(\"_defaults.R\"))\n```\n:::\n\n\n## Setting up the grid samples\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n  p = seq(0, 1, length = 1000),\n  dens = dbeta(p, 6+1, 3+1),\n  posterior = dens/sum(dens)\n) ->\n  posterior_grid\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_grid |> \n  ggplot(aes(p, posterior))+\n    geom_area(fill = ptol_blue, color = \"black\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=576}\n:::\n:::\n\n\n### Sampling from the posterior\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_grid |> \n  sample_n(\n    size = 1e4,\n    replace = T,\n    weight = posterior\n  )->\n  posterior_samples\n```\n:::\n\n\nThis isn't MCMC sampling, but I'll plot it as a line just for consistency for how MCMC chains look.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  mutate(\n    sample = row_number()\n  ) |> \n  ggplot(aes(sample, p))+\n    geom_line()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=576}\n:::\n:::\n\n\nComparing to the sampling to the original density function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  ggplot(aes(p))+\n    stat_density(\n      fill = ptol_blue\n      ) +\n    geom_line(\n      data = posterior_grid,\n      aes(y = dens),\n      color = ptol_red,\n      linewidth = 1\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=576}\n:::\n:::\n\n\n## Quantiles\n\nFirst manually\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  reframe(\n    lowhi = quantile(p, probs = c(0.25, 0.75))\n  ) |> \n  pull(lowhi)->\n  fifty_quantile\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  ggplot(aes(p))+\n    ggdist::stat_slab(\n      color = \"black\",\n      aes(\n        fill = after_stat(\n          x >= fifty_quantile[1] & x <= fifty_quantile[2]\n        )\n      )\n    )+\n    labs(\n      fill = \"fifty\",\n      y = NULL\n    )+\n    scale_fill_manual(\n      values = c(\"grey90\", ptol_blue)\n    )+\n    theme(\n      axis.text.y = element_blank(),\n      panel.grid.major.y = element_blank()\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=576}\n:::\n:::\n\n\nI think I'll create a shortcut theme for having no y axis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_no_y <- function(){\n  theme(\n      axis.text.y = element_blank(),\n      axis.title.y = element_blank(),\n      panel.grid.major.y = element_blank()\n    )\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  ggplot(aes(p))+\n    stat_slab() +\n    theme_no_y()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=576}\n:::\n:::\n\n\n### Tidybayes functions\n\nI'm not 100% sure how all of the tidybayes functions work.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  summarise(\n    median_qi(p, .width = 0.5)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 6\n      y  ymin  ymax .width .point .interval\n  <dbl> <dbl> <dbl>  <dbl> <chr>  <chr>    \n1 0.644 0.542 0.738    0.5 median qi       \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  reframe(\n    quantile  = quantile(p, probs = c(0.25, 0.5, 0.75))\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 1\n  quantile\n     <dbl>\n1    0.542\n2    0.644\n3    0.738\n```\n:::\n:::\n\n\nOk, `*_qi()` returns the quantile interval.\n\nI'd like to make the plot according to the statistics calculated by `stat_halfeye()`, but can't seem to get it to work.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  ggplot(aes(p))+\n    stat_halfeye(\n      .width = 0.5,\n      aes(\n        fill = after_stat(x > xmin)\n      )\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=576}\n:::\n:::\n\n\nI'll just do the same filling I did before.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  ggplot(aes(p))+\n    stat_halfeye(\n      .width = 0.5,\n      point_interval = median_qi,\n      slab_color = \"black\",\n      aes(\n        fill = after_stat(\n          x >= fifty_quantile[1] & x <= fifty_quantile[2]\n        )\n      )\n    )+\n  scale_fill_manual(\n      values = c(\"grey90\", ptol_blue)\n    )+\n  labs(fill = \"fifty\")+\n  theme_no_y()->\n  fifty_qi\nfifty_qi\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=576}\n:::\n:::\n\n\n### HPDI\n\nLemme try hpdi now.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  summarise(\n    mean_hdi(p, .width = 0.5)\n  )->\n  posterior_hdi\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  ggplot(aes(p))+\n    stat_halfeye(\n      .width = 0.5,\n      point_interval = median_hdi,\n      slab_color = \"black\",\n      aes(\n        fill = after_stat(\n          x >= posterior_hdi$ymin & \n            x <=  posterior_hdi$ymax\n        )\n      )\n    )+\n  scale_fill_manual(\n      values = c(\"grey90\", ptol_blue)\n    )+\n  labs(fill = \"fifty\")+\n  theme_no_y()->\n  fifty_hdi\nfifty_hdi\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfifty_qi/fifty_hdi\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=576}\n:::\n:::\n\n\nThey're very similar, but if I mix the qi fill and the hdi interval, they're different.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_samples |> \n  ggplot(aes(p))+\n    stat_halfeye(\n      .width = 0.5,\n      point_interval = median_hdi,\n      slab_color = \"black\",\n      aes(\n        fill = after_stat(\n         x >= fifty_quantile[1] & x <= fifty_quantile[2]\n        )\n      )\n    )+\n  scale_fill_manual(\n      values = c(\"grey90\", ptol_blue)\n    )+\n  labs(fill = \"fifty\")+\n  theme_no_y()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=576}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}